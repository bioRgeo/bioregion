<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>5.1 Visualization â€¢ bioregion</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="5.1 Visualization">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bioregion</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/bioregion.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a1_install_binary_files.html">1. Installation of the binary files</a></li>
    <li><a class="dropdown-item" href="../articles/a2_matrix_and_network_formats.html">2. Matrix and network formats</a></li>
    <li><a class="dropdown-item" href="../articles/a3_pairwise_metrics.html">3. Pairwise similarity/dissimilarity metrics</a></li>
    <li><a class="dropdown-item" href="../articles/a4_1_hierarchical_clustering.html">4.1 Hierarchical clustering</a></li>
    <li><a class="dropdown-item" href="../articles/a4_2_non_hierarchical_clustering.html">4.2 Non-hierarchical clustering</a></li>
    <li><a class="dropdown-item" href="../articles/a4_3_network_clustering.html">4.3 Network clustering</a></li>
    <li><a class="dropdown-item" href="../articles/a4_4_microbenchmark.html">4.4 Microbenchmark</a></li>
    <li><a class="dropdown-item" href="../articles/a5_1_visualization.html">5.1 Visualization</a></li>
    <li><a class="dropdown-item" href="../articles/a5_2_compare_partitions.html">5.2 Compare partitions</a></li>
    <li><a class="dropdown-item" href="../articles/a5_3_summary_metrics.html">5.3 Summary metrics</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://github.com/bioRgeo/bioregion/releases/tag/v1.1.1">Version 1.1.1</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/bioRgeo/bioregion/releases/tag/v1.1.0">Version 1.1.0</a></li>
    <li><a class="external-link dropdown-item" href="https://github.com/bioRgeo/bioregion/releases/tag/v1.0.0">Version 1.0.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bioRgeo/bioregion/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>5.1 Visualization</h1>
                        <h4 data-toc-skip class="author">Pierre Denelle,
Boris Leroy and Maxime Lenormand</h4>
            
            <h4 data-toc-skip class="date">2024-12-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bioRgeo/bioregion/blob/master/vignettes/a5_1_visualization.Rmd" class="external-link"><code>vignettes/a5_1_visualization.Rmd</code></a></small>
      <div class="d-none name"><code>a5_1_visualization.Rmd</code></div>
    </div>

    
    
<p>In this vignette, we aim at illustrating how to plot the bioregions
identified with the diferent algorithms available in
<code>bioregion</code>. <br> Using one of the dataset coming along with
<code>bioregion</code>, we show three strategies to plot your
results.</p>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>For this vignette, we rely on the dataset describing the distribution
of vascular plants in the Mediterranean part of France. We first load
the matrix format of this dataset, computes the dissimilarity matrix out
of it and also load the data.frame format of the data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">vegemat</span><span class="op">)</span></span>
<span><span class="va">vegedissim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dissimilarity.html">dissimilarity</a></span><span class="op">(</span><span class="va">vegemat</span>, metric <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">vegedf</span><span class="op">)</span></span></code></pre></div>
<p>Since we aim at plotting the result, we also need the object
<code>fishsf</code> linking each site of the dataset to a geometry.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">vegesf</span><span class="op">)</span></span></code></pre></div>
<p>We also import the world coastlines, available from the
<code>rnaturalearth</code> R package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world</span> <span class="op">&lt;-</span> <span class="fu">rnaturalearth</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_coastline.html" class="external-link">ne_coastline</a></span><span class="op">(</span>returnclass <span class="op">=</span> <span class="st">"sf"</span>, scale <span class="op">=</span> <span class="st">"medium"</span><span class="op">)</span></span>
<span><span class="co"># Align the CRS of both objects</span></span>
<span><span class="va">vegesf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">vegesf</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">world</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plots">Plots<a class="anchor" aria-label="anchor" href="#plots"></a>
</h2>
<p>In this section, we show three ways to plot your results. <br></p>
<div class="section level3">
<h3 id="map_bioregions">map_bioregions()<a class="anchor" aria-label="anchor" href="#map_bioregions"></a>
</h3>
<p>The first possibility is to use the function
<code><a href="../reference/map_bioregions.html">map_bioregions()</a></code> from the package. This function can
directly provide a plot of each site colored according to the cluster
they belong to. <br> Letâ€™s take an example with a K-means clustering,
with a number of clusters set to 3.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vege_nhclu_kmeans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nhclu_kmeans.html">nhclu_kmeans</a></span><span class="op">(</span><span class="va">vegedissim</span>, n_clust <span class="op">=</span> <span class="fl">3</span>, index <span class="op">=</span> <span class="st">"Simpson"</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/map_bioregions.html">map_bioregions()</a></code> function can now simply takes the
object <code>fish_nhclu_kmeans</code>, which is of
<code>bioregion.clusters</code> class, and the spatial distribution of
sites, stored in <code>fishsf</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/map_bioregions.html">map_bioregions</a></span><span class="op">(</span><span class="va">vege_nhclu_kmeans</span>, geometry <span class="op">=</span> <span class="va">vegesf</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="a5_1_visualization_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="custom-plot">Custom plot<a class="anchor" aria-label="anchor" href="#custom-plot"></a>
</h3>
<p>If you want to customize yourself the plot and not simply rely on the
default option, <code><a href="../reference/map_bioregions.html">map_bioregions()</a></code> gives you the possibility
to extract each site as well as its geometry and cluster number.<br>
For this purpose, you can set the arguments like in the chunk below:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_bioregions.html">map_bioregions</a></span><span class="op">(</span><span class="va">vege_nhclu_kmeans</span>, geometry <span class="op">=</span> <span class="va">vegesf</span>,</span>
<span>                         write_clusters <span class="op">=</span> <span class="cn">TRUE</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">custom</span></span></code></pre></div>
<pre><code><span><span class="co">## Simple feature collection with 715 features and 2 fields</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 1.686171 ymin: 42.29604 xmax: 7.798711 ymax: 45.13742</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span>
<span><span class="co">## First 10 features:</span></span>
<span><span class="co">##    ID K_3                       geometry</span></span>
<span><span class="co">## 1  35   3 POLYGON ((6.098099 45.13742...</span></span>
<span><span class="co">## 2  36   3 POLYGON ((6.22521 45.13381,...</span></span>
<span><span class="co">## 3  37   3 POLYGON ((6.352304 45.13007...</span></span>
<span><span class="co">## 4  38   3 POLYGON ((6.47938 45.12617,...</span></span>
<span><span class="co">## 5  39   3 POLYGON ((6.606438 45.12213...</span></span>
<span><span class="co">## 6  84   3 POLYGON ((6.093117 45.04745...</span></span>
<span><span class="co">## 7  85   3 POLYGON ((6.220024 45.04385...</span></span>
<span><span class="co">## 8  86   3 POLYGON ((6.346914 45.04011...</span></span>
<span><span class="co">## 9  87   3 POLYGON ((6.473786 45.03622...</span></span>
<span><span class="co">## 10 88   3 POLYGON ((6.600641 45.03219...</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Crop world coastlines to the extent of the sf object of interest</span></span>
<span><span class="va">europe</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop</a></span><span class="op">(</span><span class="va">world</span>, <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">custom</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">custom</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">K_3</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">europe</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Kmeans with 3 clusters"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="a5_1_visualization_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="plot-with-facets">Plot with facets<a class="anchor" aria-label="anchor" href="#plot-with-facets"></a>
</h3>
<p>Finally, you can be interested in plotting several
bioregionalisations at once. For this purpose, we can build a single
<code>data.frame</code> gathering all the bioregions obtained from
distinct algorithms and then take advantage of the <code>facets</code>
implemented in <code>ggplot2</code>. <br></p>
<p>We first compute a few more bioregionalisation on the same dataset
using other algorithms. <br></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Hierarchical clustering</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">vege_hclu_hierarclust</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hclu_hierarclust.html">hclu_hierarclust</a></span><span class="op">(</span>dissimilarity <span class="op">=</span> <span class="va">vegedissim</span>,</span>
<span>                                          index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vegedissim</span><span class="op">)</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span>,</span>
<span>                                          method <span class="op">=</span> <span class="st">"average"</span>, n_clust <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">vege_hclu_hierarclust</span><span class="op">$</span><span class="va">cluster_info</span></span></code></pre></div>
<pre><code><span><span class="co">##   partition_name n_clust requested_n_clust output_cut_height</span></span>
<span><span class="co">## 1            K_3       3                 3            0.5625</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Walktrap network bioregionalization</span></span>
<span><span class="va">vegesim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dissimilarity_to_similarity.html">dissimilarity_to_similarity</a></span><span class="op">(</span><span class="va">vegedissim</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">vege_netclu_walktrap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/netclu_walktrap.html">netclu_walktrap</a></span><span class="op">(</span><span class="va">vegesim</span>,</span>
<span>                                        index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vegesim</span><span class="op">)</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">vege_netclu_walktrap</span><span class="op">$</span><span class="va">cluster_info</span> <span class="co"># 3</span></span></code></pre></div>
<pre><code><span><span class="co">##     partition_name n_clust</span></span>
<span><span class="co">## K_3            K_3       3</span></span></code></pre>
<p>We can now make a single <code>data.frame</code> with an extra-column
indicating the algorithm used.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vege_kmeans</span> <span class="op">&lt;-</span> <span class="va">vege_nhclu_kmeans</span><span class="op">$</span><span class="va">clusters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">vege_kmeans</span><span class="op">)</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"NHCLU_KMEANS"</span><span class="op">)</span></span>
<span><span class="va">vege_hieraclust</span> <span class="op">&lt;-</span> <span class="va">vege_hclu_hierarclust</span><span class="op">$</span><span class="va">clusters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">vege_hieraclust</span><span class="op">)</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"HCLU_HIERARCLUST"</span><span class="op">)</span></span>
<span><span class="va">vege_walktrap</span> <span class="op">&lt;-</span> <span class="va">vege_netclu_walktrap</span><span class="op">$</span><span class="va">clusters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">vege_walktrap</span><span class="op">)</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"NETCLU_Walktrap"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">all_clusters</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">vege_kmeans</span>, <span class="va">vege_hieraclust</span>, by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span>
<span><span class="va">all_clusters</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">all_clusters</span>, <span class="va">vege_walktrap</span>, by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span></code></pre></div>
<p>We now convert this <code>data.frame</code> into a long-format
<code>data.frame</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_long</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">all_clusters</span>,</span>
<span>                                cols <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"_"</span><span class="op">)</span>,</span>
<span>                                names_to <span class="op">=</span> <span class="st">"Algorithm"</span>,</span>
<span>                                values_to <span class="op">=</span> <span class="st">"Clusters"</span><span class="op">)</span></span>
<span><span class="va">all_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">all_long</span><span class="op">)</span></span></code></pre></div>
<p>We now add back the geometry as an extra column to make this object
spatial.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_long_sf</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">all_long</span>,</span>
<span>                                <span class="va">vegesf</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"geometry"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                                by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span>
<span><span class="va">all_long_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">all_long_sf</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have a long-format spatial <code>data.frame</code>, we
can take advantage of the facets implemented in
<code>ggplot2</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">all_long_sf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">Clusters</span>, fill <span class="op">=</span> <span class="va">Clusters</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">europe</span>, fill <span class="op">=</span> <span class="st">"gray80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_d</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">Algorithm</span><span class="op">)</span></span></code></pre></div>
<p><img src="a5_1_visualization_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
<p>We can refine the above map by: * reordering the 3 bioregions so that
they follow the same order * add some background for the Mediterranean
sea and the mainland * crop the cells by the mainland * adjust
labels</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world_countries</span> <span class="op">&lt;-</span> <span class="fu">rnaturalearth</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="st">"medium"</span>,</span>
<span>                                               returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Background box</span></span>
<span><span class="va">xmin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">world</span><span class="op">)</span><span class="op">[[</span><span class="st">"xmin"</span><span class="op">]</span><span class="op">]</span>; <span class="va">xmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">world</span><span class="op">)</span><span class="op">[[</span><span class="st">"xmax"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">ymin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">world</span><span class="op">)</span><span class="op">[[</span><span class="st">"ymin"</span><span class="op">]</span><span class="op">]</span>; <span class="va">ymax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">world</span><span class="op">)</span><span class="op">[[</span><span class="st">"ymax"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_make_grid.html" class="external-link">st_make_grid</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">xmin</span>,</span>
<span>                                              xmax <span class="op">=</span> <span class="va">xmax</span>,</span>
<span>                                              ymax <span class="op">=</span> <span class="va">ymax</span>,</span>
<span>                                              ymin <span class="op">=</span> <span class="va">ymin</span><span class="op">)</span>,</span>
<span>                                            crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Crop world coastlines to the extent of the sf object of interest</span></span>
<span><span class="va">vegesf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">vegesf</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">world</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">larger_bbox</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">vegesf</span><span class="op">)</span></span>
<span><span class="va">larger_bbox</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1.5</span></span>
<span><span class="va">larger_bbox</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">42.15</span></span>
<span><span class="va">larger_bbox</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">8.1</span></span>
<span><span class="va">larger_bbox</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">45.3</span></span>
<span></span>
<span><span class="va">europe</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop</a></span><span class="op">(</span><span class="va">world</span>, <span class="va">larger_bbox</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html" class="external-link">sf_use_s2</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">europe_countries</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop</a></span><span class="op">(</span><span class="va">world_countries</span>, <span class="va">larger_bbox</span><span class="op">)</span></span>
<span><span class="va">europe_bb</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop</a></span><span class="op">(</span><span class="va">bb</span>, <span class="va">larger_bbox</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_basis</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">europe</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">europe_bb</span>, fill <span class="op">=</span> <span class="st">"aliceblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">europe_countries</span>, fill <span class="op">=</span> <span class="st">"ivory"</span>, color <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Reordering bioregions</span></span>
<span><span class="va">all_long_sf</span><span class="op">$</span><span class="va">bioregion</span> <span class="op">&lt;-</span> <span class="va">all_long_sf</span><span class="op">$</span><span class="va">Clusters</span></span>
<span></span>
<span><span class="va">all_long_sf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">all_long_sf</span><span class="op">$</span><span class="va">Algorithm</span> <span class="op">==</span> <span class="st">"HCLU_HIERARCLUST"</span> <span class="op">&amp;</span></span>
<span>                    <span class="va">all_long_sf</span><span class="op">$</span><span class="va">Clusters</span> <span class="op">==</span> <span class="st">"2"</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">bioregion</span> <span class="op">&lt;-</span> <span class="st">"1"</span></span>
<span><span class="va">all_long_sf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">all_long_sf</span><span class="op">$</span><span class="va">Algorithm</span> <span class="op">==</span> <span class="st">"HCLU_HIERARCLUST"</span> <span class="op">&amp;</span></span>
<span>                    <span class="va">all_long_sf</span><span class="op">$</span><span class="va">Clusters</span> <span class="op">==</span> <span class="st">"1"</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">bioregion</span> <span class="op">&lt;-</span> <span class="st">"2"</span></span>
<span></span>
<span><span class="va">all_long_sf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">all_long_sf</span><span class="op">$</span><span class="va">Algorithm</span> <span class="op">==</span> <span class="st">"NHCLU_KMEANS"</span> <span class="op">&amp;</span></span>
<span>                    <span class="va">all_long_sf</span><span class="op">$</span><span class="va">Clusters</span> <span class="op">==</span> <span class="st">"3"</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">bioregion</span> <span class="op">&lt;-</span> <span class="st">"2"</span></span>
<span><span class="va">all_long_sf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">all_long_sf</span><span class="op">$</span><span class="va">Algorithm</span> <span class="op">==</span> <span class="st">"NHCLU_KMEANS"</span> <span class="op">&amp;</span></span>
<span>                    <span class="va">all_long_sf</span><span class="op">$</span><span class="va">Clusters</span> <span class="op">==</span> <span class="st">"1"</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">bioregion</span> <span class="op">&lt;-</span> <span class="st">"1"</span></span>
<span><span class="va">all_long_sf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">all_long_sf</span><span class="op">$</span><span class="va">Algorithm</span> <span class="op">==</span> <span class="st">"NHCLU_KMEANS"</span> <span class="op">&amp;</span></span>
<span>                    <span class="va">all_long_sf</span><span class="op">$</span><span class="va">Clusters</span> <span class="op">==</span> <span class="st">"2"</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">bioregion</span> <span class="op">&lt;-</span> <span class="st">"3"</span></span>
<span></span>
<span><span class="va">all_long_sf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">all_long_sf</span><span class="op">$</span><span class="va">Algorithm</span> <span class="op">==</span> <span class="st">"NETCLU_Walktrap"</span> <span class="op">&amp;</span></span>
<span>                    <span class="va">all_long_sf</span><span class="op">$</span><span class="va">Clusters</span> <span class="op">==</span> <span class="st">"3"</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">bioregion</span> <span class="op">&lt;-</span> <span class="st">"1"</span></span>
<span><span class="va">all_long_sf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">all_long_sf</span><span class="op">$</span><span class="va">Algorithm</span> <span class="op">==</span> <span class="st">"NETCLU_Walktrap"</span> <span class="op">&amp;</span></span>
<span>                    <span class="va">all_long_sf</span><span class="op">$</span><span class="va">Clusters</span> <span class="op">==</span> <span class="st">"1"</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">bioregion</span> <span class="op">&lt;-</span> <span class="st">"2"</span></span>
<span><span class="va">all_long_sf</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">all_long_sf</span><span class="op">$</span><span class="va">Algorithm</span> <span class="op">==</span> <span class="st">"NETCLU_Walktrap"</span> <span class="op">&amp;</span></span>
<span>                    <span class="va">all_long_sf</span><span class="op">$</span><span class="va">Clusters</span> <span class="op">==</span> <span class="st">"2"</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">bioregion</span> <span class="op">&lt;-</span> <span class="st">"3"</span></span>
<span></span>
<span><span class="co"># More readable labels for algorithms</span></span>
<span><span class="va">all_long_sf</span><span class="op">$</span><span class="va">Algo</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">all_long_sf</span><span class="op">$</span><span class="va">Algorithm</span> <span class="op">==</span> <span class="st">"NHCLU_KMEANS"</span>, <span class="st">"K-Means"</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">all_long_sf</span><span class="op">$</span><span class="va">Algorithm</span> <span class="op">==</span> <span class="st">"NHCLU_PAM"</span>, <span class="st">"PAM"</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">all_long_sf</span><span class="op">$</span><span class="va">Algorithm</span> <span class="op">==</span> <span class="st">"HCLU_HIERARCLUST"</span>,</span>
<span>                       <span class="st">"Hierarchical Clustering"</span>, <span class="st">"Walktrap"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Cropping with borders of France</span></span>
<span><span class="va">all_long_sf_france</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html" class="external-link">st_intersection</a></span><span class="op">(</span><span class="va">all_long_sf</span>,</span>
<span>                  <span class="va">europe_countries</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">europe_countries</span><span class="op">$</span><span class="va">sovereignt</span> <span class="op">==</span> <span class="st">"France"</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="va">final_plot</span> <span class="op">&lt;-</span> <span class="va">plot_basis</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">all_long_sf_france</span>,</span>
<span>          <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">bioregion</span>, fill <span class="op">=</span> <span class="va">bioregion</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="va">all_long_sf_france</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"NA"</span>, color <span class="op">=</span> <span class="st">"gray50"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">europe</span>, fill <span class="op">=</span> <span class="st">"gray50"</span>, linewidth <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_viridis_d</span><span class="op">(</span><span class="st">"Bioregion"</span>, option <span class="op">=</span> <span class="st">"magma"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span><span class="st">"Bioregion"</span>, option <span class="op">=</span> <span class="st">"magma"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_void</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">Algo</span><span class="op">)</span></span>
<span><span class="va">final_plot</span></span></code></pre></div>
<p><img src="a5_1_visualization_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Maxime Lenormand, Boris Leroy, Pierre Denelle.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
